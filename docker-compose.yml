services:
  integration-service:
    build:
      context: ./integration_service
      dockerfile: Dockerfile
    container_name: neurograph-ai-assistant-integration-service
    ports:
      - "${API_PORT:-9000}:9000"
    environment:
      - API_PORT=${API_PORT:-9000}
      - ATOMSPACE_API_URL=http://atomspace-api-dev:8000
      - NEURAL_MINER_URL=http://neural-miner:5000
      - ANNOTATION_SERVICE_URL=${ANNOTATION_SERVICE_URL:-http://annotation-service:6000}
      - ATOMSPACE_TIMEOUT=${ATOMSPACE_TIMEOUT:-600}
      - MINER_TIMEOUT=${MINER_TIMEOUT:-1800}
      - ANNOTATION_TIMEOUT=${ANNOTATION_TIMEOUT:-300}
      - CSV_CACHE_DIR=${CSV_CACHE_DIR:-./cache}
      - SHARED_VOLUME_PATH=${SHARED_VOLUME_PATH:-/shared/output}
    volumes:
      - shared_output:/shared/output
      - ./integration_service/output:/app/output
      - csv_cache:/tmp/csv_cache
    networks:
      - custom-atomspace-builder_atomspace-network
    restart: always

  neural-miner:
    build: ./submodules/neural-subgraph-matcher-miner
    container_name: neurograph-ai-assistant-neural-miner
    volumes:
      - shared_output:/shared/output
    networks:
      - custom-atomspace-builder_atomspace-network
    restart: always

volumes:
  shared_output:
    name: shared_output
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${PWD}/submodules/custom-atomspace-builder/output
  csv_cache:

networks:
  custom-atomspace-builder_atomspace-network:
    external: true